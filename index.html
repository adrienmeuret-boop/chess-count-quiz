<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self' 'unsafe-inline' cdn.jsdelivr.net code.jquery.com cdnjs.cloudflare.com fonts.googleapis.com fonts.gstatic.com;
                 script-src 'self' cdn.jsdelivr.net code.jquery.com 'unsafe-inline' cdnjs.cloudflare.com fonts.googleapis.com fonts.gstatic.com">

  <link rel="stylesheet" href="chessboard/css/chessboard-1.0.0.min.css">

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="chessboard/js/chessboard-1.0.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.2/chess.min.js"></script>

  <title>Chess Count Quiz</title>
  <link rel="stylesheet" href="chess-count-quiz.css">
</head>

<body>
  <h2>Chess Move Count Quiz</h2>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal">
    <div class="modal-content">
      <span class="close-button">×</span>
      <h2>Settings</h2>

      <form id="settingsForm">
        <div>
          <label><input type="checkbox" id="showTimer">Enable Timer</label>
        </div>
        <br>

        <div>
          Player to move:
          <label><input type="radio" name="playerToMove" value="White">White</label>
          <label><input type="radio" name="playerToMove" value="Black">Black</label>
          <label><input type="radio" name="playerToMove" value="Random" checked>Random</label>
        </div>
        <br>

        <div>
          <label><input type="checkbox" id="enableP1AllLegal" name="quizOption" value="p1AllLegal">Count all of player 1's legal moves</label>
        </div>
        <div>
          <label><input type="checkbox" id="enableP1Checks" name="quizOption" value="p1Checks">Count Player 1's checks</label>
        </div>
        <div>
          <label><input type="checkbox" id="enableP1Captures" name="quizOption" value="p1Captures">Count player 1's captures</label>
        </div>
        <br>

        <div>
          <label><input type="checkbox" id="enableP2AllLegal" name="quizOption" value="p2AllLegal">Count all of player 2's legal moves</label>
        </div>
        <div>
          <label><input type="checkbox" id="enableP2Checks" name="quizOption" value="p2Checks">Count player 2's checks</label>
        </div>
        <div>
          <label><input type="checkbox" id="enableP2Captures" name="quizOption" value="p2Captures">Count player 2's captures</label>
        </div>
        <br>

        <div>
          <label>Plies ahead to visualize:
            <input type="number" id="plyAhead" min="0" max="10" value="0" style="width: 60px">
          </label>
        </div>
        <br>

        <button type="button" onclick="saveSettings()">Save Settings</button>
      </form>
    </div>
  </div>

  <div class="container">
    <!-- LEFT COLUMN -->
    <div class="board-col">
      <div id="board"></div>
    </div>

    <!-- MIDDLE COLUMN -->
    <div class="info">
      <div id="score">Score: 0</div>

      <div id="remainingMoves"></div>

      <form id="chessCountForm">
        <div id="count-inputs">
          <!-- Dynamic input fields will be appended here based on settings -->
        </div>

        <!-- Submit aligné comme les boutons highlight (plein largeur) -->
        <button type="submit" id="submit" class="action-button full-width">Submit Counts</button>
      </form>

      <!-- Espace vide = même hauteur que l'ancien bouton Show Moves (réglé en CSS) -->
      <div class="submit-gap"></div>

      <div id="boardHighlightsControls">
        <button id="hl_p1AllLegal" class="action-button" type="button">White’s Moves</button>
        <button id="hl_p2AllLegal" class="action-button" type="button">Black’s Moves</button>
        <button id="hl_p1Checks" class="action-button" type="button">White’s Checks</button>
        <button id="hl_p2Checks" class="action-button" type="button">Black’s Checks</button>
        <button id="hl_p1Captures" class="action-button" type="button">White’s Captures</button>
        <button id="hl_p2Captures" class="action-button" type="button">Black’s Captures</button>
        <button id="hl_clear" class="action-button" type="button">Clear</button>
      </div>

      <!-- Légende SOUS les boutons -->
      <div id="pieceLegend" class="legend">
        <div class="legend-title">Legend</div>

        <div class="legend-grid">
          <div class="legend-item"><span class="legend-swatch piece-p"></span><span class="legend-label">Pawn (P)</span></div>
          <div class="legend-item"><span class="legend-swatch piece-n"></span><span class="legend-label">Knight (N)</span></div>
          <div class="legend-item"><span class="legend-swatch piece-b"></span><span class="legend-label">Bishop (B)</span></div>
          <div class="legend-item"><span class="legend-swatch piece-r"></span><span class="legend-label">Rook (R)</span></div>
          <div class="legend-item"><span class="legend-swatch piece-q"></span><span class="legend-label">Queen (Q)</span></div>
          <div class="legend-item"><span class="legend-swatch piece-k"></span><span class="legend-label">King (K)</span></div>
          <div class="legend-item"><span class="legend-swatch side-w"></span><span class="legend-label">Player: White</span></div>
          <div class="legend-item"><span class="legend-swatch side-b"></span><span class="legend-label">Player: Black</span></div>
        </div>

        <div class="legend-note">
          When multiple pieces reach the same square, the big square uses the player color (white / black).
        </div>

        <div class="legend-note">
          When the same piece (or piece type) reaches a square multiple times, the marker becomes solid.
    <div class="legend-example">
  <span class="legend-swatch solid-demo solid"></span>
  <span class="legend-arrow">→</span>
  <span class="legend-swatch solid-demo solid"></span>
</div>
        </div>
      </div>
    </div>

    <!-- SPACER COLUMN (vide, pour respirer) -->
    <div class="spacer-col"></div>

    <!-- RIGHT COLUMN (TIMER + Show Moves dessous) -->
    <div class="timer-col">
      <div id="timerSection">
        <div id="timer">Time: 03:00</div>
        <p class="timer-penalty">10 second penalty per wrong answer</p>
      </div>

      <!-- Show Moves sous le timer -->
      <button id="showMovesButton" class="action-button full-width" type="button">Show Moves</button>

      <div id="movesList"></div>
    </div>
  </div>

  <div id="movesList"></div>
  
  <div class="footer-block">
    <button id="settingsButton" type="button" class="action-button">
      Settings
    </button>

    <p>Positions from the <a href="https://database.lichess.org/">Lichess puzzle database</a></p>
<p>See <a href="https://github.com/adrienmeuret-boop/chess-count-quiz">https://github.com/adrienmeuret-boop/chess-count-quiz</a> for source code</p>
  </div>

  <script src="chess-count-quiz.js"></script>
</body>
</html>
